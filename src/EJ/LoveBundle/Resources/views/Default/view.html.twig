{% extends "EJLoveBundle:Default:layout.html.twig" %}

{% block title %}
    Partie en cours - {{ parent() }}
{% endblock %}

{% block ll_body %}
    <link rel="stylesheet"
          type="text/css"
          href="http://localhost/WebLoveLetter/web/pulse.css"
    />
    <div id="game" class="container">
        <div id="header"  class="jumbotron">
            <a type="button" class="btn btn-info pulse-danger" href={{ path('LoveBundle_reset', {'gameid': game.id}) }}>Reset this game !</a>
            <button type="button" class="btn btn-info pulse-danger" data-toggle="collapse" data-target="#debug">Info debuggage</button>
            <div id="debug" class="collapse well">
                Tableau des joueurs :
                {{ dump(game.players)}}
                Tour du joueur n° :
                {{ dump(game.playerTurn)}}
                Tableau des cartes en main des joueurs
                {{ dump(game.cardsInHand)}}
                Tableau des cartes jouées par les joueurs
                {{ dump(game.cardsPlayed)}}
                Tableau de la pioche
                {{ dump(game.cardsInDeck)}}
                Tableau de la défausse
                {{ dump(game.cardsDiscarded)}}
                Carte Secrete:
                {{ dump(game.cardHidden)}}
            </div>

            <h1>Partie numéro {{ game.id }}</h1>
                {% for player,values in game.cardsInHand %}
                    <h3>{{ player }}</h3>
                    <ul class="list-inline">
                        <h4>Hand :</h4>
                        {% for key, value in values %}
                            <li><img class="pulse-primary" title="Action" data-toggle="popover" data-placement="bottom" data-html="true" data-content="<a href={{ path('LoveBundle_playcard', {'gameid': game.id,'playerid': player,'cardid': value}) }}>Play this card</a><br>
                            <a href={{ path('LoveBundle_discard', {'gameid': game.id,'playerid': player,'cardid': value}) }}>Discard</a>"
                                     src="{{ game.card(value).imageCarte }}" alt="{{ game.card(value).nomCarte }}"></li>
                        {% endfor %}
                        <h4>Board :</h4>
                        {% for key, value in game.cardsPlayed[player] %}
                            <li><img src="{{ game.card(value).imageCarte }}" alt="{{ game.card(value).nomCarte }}"></li>
                        {% endfor %}
                    </ul>
                {% endfor %}
                 <h4>Deck :</h4>
                <a type="button" class="btn btn-info pulse-success" href={{ path('LoveBundle_draw', {'gameid': game.id,'playerid': 'player1'}) }}>Piocher !</a>
                <ul class="list-inline">
                {% for key, value in game.cardsInDeck %}
                    <li><img src="{{ game.card(value).imageCarte }}" alt="{{ game.card(value).nomCarte }}"></li>
                {% endfor %}
                <h4>Discards :</h4>
                {% for key, value in game.cardsDiscarded %}
                    {% if value == game.cardHidden %}
                        <li><img src="{{ game.card(16).imageCarte }}" alt="{{ game.card(16).nomCarte }}"></li>
                    {% else %}
                        <li><img src="{{ game.card(value).imageCarte }}" alt="{{ game.card(value).nomCarte }}"></li>
                    {% endif %}
                {% endfor %}
                </ul>

                <script type="text/javascript">
                    $(document).ready(function(){
                        $('[data-toggle="popover"]').popover();
                    });
                    var auto_refresh = setInterval(function () {
                            $.getJSON('{{ path('LoveBundle_refresh',{'gameid': game.id}) }}',function (data) {
                                alert(data);
                                if ({{ game.playerTurn }} != data){
                                    $('#game').load("{{ game.id }} #game").fadeIn("slow");
                                    alert("Rafraichi : db update");
                                }
                            })
                        }, 2000); // refresh every 2000 milliseconds
                </script>

        </div>
        <hr>
    </div>


{% endblock %}