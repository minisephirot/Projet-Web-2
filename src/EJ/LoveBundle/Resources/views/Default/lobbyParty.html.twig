{% extends "EJLoveBundle:Default:layout.html.twig" %}

{% block title %}
    Partie en cours - {{ parent() }}
{% endblock %}

{% block ll_body %}

    <div id="party" class="container">
        <div class="well">
            <button type="button" class="btn btn-info pulse-danger" data-toggle="collapse" data-target="#debug">Info debuggage</button>
            <div id="debug" class="collapse well">
                Liste des joueurs dans la partie :
                {{ dump(party.partyPlayers)}}
                Nombre de joueurs dans la partie :
                {{ dump(party.getNbPlayers)}}
                Liste des scores des joueurs dans la partie :
                {{ dump(party.playerScore)}}
                Est-ce que la partie est demarr√©e (1:Oui/0:Non) :
                {{ dump(party.isStarted)}}
                Est-ce que la partie est finie (1:Oui/0:Non) :
                {{ dump(party.isOver)}}
            </div><br>
            <h1>Partie de {{ party.host }} : <small>({{ party.getNbPlayers}} joueurs inscrits)</small></h1><br>

            <table style="width:25%" class="table" frame="box" rules="none">
                {% for key, value in party.partyPlayers %}
                   <tr><td>{{ value }}</td></tr>
                {% endfor %}
            </table>



            {% if app.user == party.host and party.getNbPlayers > 1  %}
                <br><a class="btn btn-primary pulse-success" href="{{ path('LoveBundle_create',{'gameid': party.id})}}">Commencer la partie</a>
            {% endif %}
        </div>
    </div>

    <script type="text/javascript">
        var nbjoueurs = {{ party.getNbPlayers}}
        var started = {{ party.isStarted }}
        var auto_refresh = setInterval(function () {
            $.getJSON('{{ path('LoveBundle_partyrefresh',{'partyid': party.id}) }}',function (data) {
                if (nbjoueurs != data[0]){
                    //$('#game').load("{{ party.id }} #game").fadeIn("slow");
                    window.location.reload();
                }
                if (data[1]){
                    window.location.replace("http://localhost"+"{{ path('LoveBundle_view',{'gameid': party.id})}}");
                }
            })
        }, 2000); // refresh every 2000 milliseconds
        
    </script>
      
{% endblock %}